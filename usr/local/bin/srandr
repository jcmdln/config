#!/usr/bin/env sh

# 'SRANDR_CONFIG_FILE' is an environment variable that allows setting
# the configuration file to load display settings from. The
# configuration file must be a shell script that contains a list of the
# displays as shown in the 'Displays' variable, which references each
# function to call that configures the desired displays as needed.
#
# #!/usr/bin/env sh
#
# Displays="VGA1 VGA2"
#
# VGA1() {
#     xrandr --output VGA1 --auto
# }
#
# VGA2() {
#     xrandr --output VGA2 --auto --right-of VGA1
# }

if [ -n "$SRANDR_CONFIG_FILE" ]; then
    export SRANDR_CONFIG_FILE="$HOME/.displays.sh"
fi


# 'Displays' is a local variable that stores the currently connected
# displays that have also been configured.

SRANDR_DISPLAYS=""


# Here we'll start an infinite loop to determine whether a new display
# has been detected and attempt to configure each display including
# turning disconnected displays off.

while :; do
    if [ -n "$DISPLAY" ]; then
        Connected="$(xrandr | grep ' connected' | awk '{print $1}')"
        if [ "$Displays" != "$Connected" ]; then
            for display in $Connected; do
                if [ -e "$SRANDR_CONFIG_FILE" ]; then
                    . "$SRANDR_CONFIG_FILE"

                    for config in $Displays; do
                        if [ "$display" == "$config" ]; then
                            $config
                        fi
                    done
                else
                    xrandr --output "$display" --auto
                fi
            done

	    Disconnected="$(xrandr | grep 'disconnected' | awk '{print $1}')"
            for display in $Disconnected; do
                xrandr --output "$display" --off
            done

            SRANDR_DISPLAYS="$Connected"
        fi
    fi

    sleep 10
done
